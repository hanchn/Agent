## **第五节 · 简单流程体验**

### 1. 学习目标

* 了解 Coze Flow（流程编排）的基本概念和结构
* 学会创建一个最小可运行的 Flow
* 掌握节点配置（输入 → 检索 → 生成 → 输出）的方法
* 能让 Flow 调用 KB，按固定模板生成结果
* 打通 **Bot + KB + Flow** 的最小闭环

---

### 2. 课程讲解

#### 2.1 什么是 Flow

* **定义**：Flow 是一组按顺序或条件执行的任务节点，用于组织 Bot 的执行逻辑。
* **作用**：

  * 将复杂任务拆解为多个步骤
  * 控制执行顺序、分支条件、变量传递
  * 在流程中调用 KB、Tool、模型
* **优势**：

  * 可视化拖拽，逻辑清晰
  * 低代码可扩展（调用外部 API）
  * 易于调试和优化

---

#### 2.2 Flow 的基本结构

| 节点类型                 | 作用          | 示例         |
| -------------------- | ----------- | ---------- |
| **Input**            | 获取用户输入      | 输入主题、受众    |
| **Knowledge Search** | 从 KB 检索相关内容 | 检索品牌调性与案例  |
| **LLM Generation**   | 调用大模型生成内容   | GPT-4 输出脚本 |
| **Condition**        | 条件判断分支      | 检查生成结果是否合规 |
| **Output**           | 返回结果给用户     | 脚本 + 标签列表  |

---

#### 2.3 Flow 与 Bot 的关系

* Bot 是“入口”，Flow 是“执行引擎”
* Bot 接收到用户请求 → 调用绑定的 Flow → Flow 内按节点执行 → 返回结果到 Bot

---

### 3. 步骤演示

#### 目标

创建一个 **“抖音脚本生成流程”**，输入主题 → 检索 KB → 生成脚本 → 返回 JSON 结果。

---

**步骤 1：新建 Flow**

1. 左侧菜单点击 **Flows**
2. 点击 **Create Flow**
3. 命名：`抖音脚本生成流程`
4. 描述：根据主题生成符合品牌调性的短视频脚本

---

**步骤 2：添加输入节点**

1. 拖拽 **Input** 节点到画布
2. 配置字段：

   * 变量名：`topic`
   * 类型：文本
   * 占位提示：`请输入短视频主题（如：夏季防晒穿搭）`

---

**步骤 3：添加知识库检索节点**

1. 添加 **Knowledge Search** 节点
2. 绑定 `品牌调性 & 案例库`
3. 检索参数：

   * 关键词：`{{topic}}`
   * Top-K：3
4. 输出变量：`kb_results`

---

**步骤 4：添加 LLM 生成节点**

1. 添加 **LLM Generation** 节点
2. 模型：`GPT-4 Turbo`
3. Prompt 示例：

   ```
   你是一名资深短视频编导。根据以下品牌资料和主题，生成一条抖音短视频脚本：
   主题：{{topic}}
   品牌资料：
   {{kb_results}}

   输出 JSON 格式：
   {
     "title": "",
     "hook": "",
     "shots": [
       {"scene": "镜头1", "description": ""},
       {"scene": "镜头2", "description": ""}
     ],
     "hashtags": []
   }
   ```
4. 输出变量：`script_json`

---

**步骤 5：添加输出节点**

1. 添加 **Output** 节点
2. 绑定变量：`{{script_json}}`
3. 格式：JSON

---

**步骤 6：保存并测试**

1. 点击右上角 **Run**
2. 输入 `夏季防晒穿搭`
3. 检查输出是否符合 JSON 格式，标题、镜头、标签是否正确

---

**步骤 7：绑定到 Bot**

1. 打开 `抖音脚本机` Bot 设置
2. 启用 Flow
3. 选择 `抖音脚本生成流程`
4. 保存 → Playground 测试 Bot

---

### 4. 优化建议

* **Prompt 调优**：增加输出约束（镜头数量、字数限制）
* **增加条件判断节点**：检查是否生成了必填字段
* **并行工具调用**：同时查询热点关键词 API，提高内容时效性
* **多风格生成**：增加分支节点，输出多种风格脚本

---

### 5. 实操案例

**案例目标**
将“新品上市文案助手”升级为能按不同平台规则生成文案的 Flow。

**流程**

1. 输入节点：产品名、目标平台（抖音/小红书/微博）
2. 检索节点：品牌 KB + 平台风格 KB
3. LLM 节点：根据不同平台调用不同 Prompt 模板
4. 输出节点：JSON + Markdown 双格式

---

### 6. 课后作业

1. 创建一个 Flow，实现：

   * 输入主题
   * 检索 KB
   * 调用 LLM 生成内容
   * 输出 JSON
2. 绑定到一个 Bot 并测试 3 次不同输入
3. 记录：

   * 检索结果 Top-K 的相关性
   * 输出质量（完整性、风格符合度）
4. 写一段 50 字的优化计划

