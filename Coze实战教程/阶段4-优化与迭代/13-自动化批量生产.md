## **第十三节 · 自动化发布与多平台分发**

### 1. 学习目标

* 理解多平台分发的流程与差异
* 学会在 Coze Flow 中集成第三方平台 API
* 掌握多平台内容格式适配与自动映射
* 能实现内容生成后自动上传到目标平台
* 掌握发布失败的回退与重试机制

---

### 2. 课程讲解

#### 2.1 为什么要自动化发布

* **节省人工**：运营团队不必手动复制粘贴
* **缩短发布时间差**：热点内容快速上线
* **减少错误**：避免手动发布时格式或标签出错
* **统一监控**：在一个系统内追踪全平台发布状态

---

#### 2.2 常见平台 API 类型

| 平台    | API 类型         | 认证方式                | 注意事项           |
| ----- | -------------- | ------------------- | -------------- |
| 抖音    | 视频/图文上传 API    | OAuth2 + 开发者 Key    | 审核机制严格，需符合视频规格 |
| 小红书   | 笔记发布 API（部分内测） | Cookie / 开发者 Key    | 对 IP 与行为有风控    |
| 微博    | 微博发布 API       | OAuth2              | 带图需多步上传        |
| 微信公众号 | 群发 API         | Access Token        | 需要先上传素材 ID     |
| 飞书    | 文档/群消息 API     | App ID + App Secret | 支持富文本、表格推送     |

---

#### 2.3 Coze 中集成外部 API

1. **HTTP Request 节点**

   * 直接调用平台 API
   * 设置 Header（Authorization、Content-Type）
   * Body 格式可绑定生成内容变量
2. **Webhook 节点**

   * 将生成结果推送到自建的中转服务
   * 中转服务再调用各个平台 API
3. **工具（Tool）集成**

   * 将 API 封装成可在 Coze 内直接调用的 Tool
   * 方便在多个流程中复用

---

### 3. 步骤演示（抖音发布）

#### 目标

生成脚本 → 发布到抖音图文 API

---

**步骤 1：准备抖音开放平台**

* 注册抖音开放平台账号
* 创建应用 → 获取 `client_key` 和 `client_secret`
* 配置回调地址 → 获取 `access_token`

---

**步骤 2：在 Coze 中创建发布节点**

* 节点类型：HTTP Request
* 请求方式：`POST`
* URL：`https://open.douyin.com/video/create/`
* Header：

  ```
  Authorization: Bearer {{douyin_access_token}}
  Content-Type: application/json
  ```
* Body：

  ```json
  {
    "video_id": "{{video_id}}",
    "title": "{{script_json.title}}",
    "text": "{{script_json.hook}}",
    "tags": "{{script_json.hashtags | join(',')}}"
  }
  ```

---

**步骤 3：格式适配**

* 抖音要求标题 ≤ 30 字 → 生成时限制
* 标签必须用英文逗号分隔 → 用 `join(',')`
* 视频先通过视频上传 API 获取 `video_id`

---

**步骤 4：测试与日志**

* 成功返回发布 ID → 存到数据库或飞书表格
* 失败时记录错误信息 → 进入重试分支

---

### 4. 多平台适配

#### 统一数据结构

在生成内容阶段，就定义统一 Schema：

```json
{
  "platform": "douyin",
  "title": "",
  "content": "",
  "hashtags": [],
  "media_url": ""
}
```

不同平台发布节点只需要映射相应字段。

#### 格式差异适配

| 平台    | 限制              | 适配方法              |
| ----- | --------------- | ----------------- |
| 抖音    | 标题 ≤ 30 字       | 生成时限制长度           |
| 小红书   | 笔记正文支持 Markdown | 输出 Markdown 格式    |
| 微博    | 文本 ≤ 2000 字     | 内容截断或分多条发         |
| 微信公众号 | HTML 模板         | 将 Markdown 转 HTML |

---

### 5. 高级玩法

* **定时发布**：生成后存储，按计划时间调用 API
* **批量发布**：一个内容一次性推送到多个平台
* **灰度发布**：先发到测试号 → 审核通过后发到正式号
* **A/B 测试**：生成两版不同文案，分平台测试点击率

---

### 6. 实操案例

**案例目标**
生成新品发布内容 → 自动推送到抖音、小红书、微信公众号
**步骤**：

1. 生成统一 Schema 文案 + 素材 URL
2. 条件分支选择平台适配逻辑
3. HTTP 节点调用各自 API
4. 记录各平台返回的内容 ID
5. 飞书消息通知运营团队：

   ```
   已自动发布新品【夏季防晒帽】
   抖音：https://v.douyin.com/xxxx
   小红书：https://www.xiaohongshu.com/xxxx
   微信公众号：已发送
   ```

---

### 7. 课后作业

1. 在你的流程中添加一个 HTTP 节点，调用飞书群消息 API，把生成结果发到群里
2. 选择一个你能用 API 发文的平台（如微信公众号测试号），配置发布节点
3. 在生成文案时，根据平台自动做格式适配
4. 测试一次完整的“生成 → 发布”流程，并记录日志


