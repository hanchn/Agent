## **第十一节 · 引入多模型协作**

### 1. 学习目标

* 理解多模型协作的概念和价值
* 掌握在 Coze 中为不同任务选择不同模型的方法
* 学会通过条件分支实现模型切换
* 能实现“便宜模型做预处理 + 高质量模型做生成”的优化模式
* 建立成本与性能的平衡策略

---

### 2. 课程讲解

#### 2.1 什么是多模型协作

在一个流程中，不同步骤调用不同的模型：

* **轻量任务**（关键词提取、意图识别、数据清洗） → 用便宜快速的小模型（如 GPT-3.5、Claude Instant）
* **复杂任务**（长文生成、创意脚本、精准推理） → 用高质量但成本更高的大模型（如 GPT-4、Claude Opus）
* **专用任务**（代码生成、翻译、图像生成） → 用专门优化过的模型（如 Codex、Mistral、Midjourney）

---

#### 2.2 为什么要这样做

* **降低成本**：高质量模型贵，不必全流程使用
* **加快速度**：小模型响应快，能快速完成预处理
* **稳定质量**：用高质量模型处理核心输出，减少失败率
* **灵活扩展**：可随时替换某一步的模型，不影响整体流程

---

#### 2.3 应用场景

| 场景         | 小模型做         | 大模型做     |
| ---------- | ------------ | -------- |
| **抖音脚本生成** | 热点关键词提取、内容分类 | 脚本正文生成   |
| **电商客服问答** | 问题意图识别、KB 检索 | 高质量多轮对答  |
| **多语言文案**  | 粗翻译、内容分段     | 精翻译、风格润色 |

---

### 3. 步骤演示（抖音脚本案例）

#### 目标

在“抖音脚本生成流程”中：

* 用小模型提取热点关键词
* 用大模型生成脚本正文

---

**步骤 1：添加关键词提取节点**

1. 在 KB 检索之前添加一个 LLM 节点
2. 模型选择：`gpt-3.5-turbo`（便宜快速）
3. Prompt：

   ```
   从以下主题中提取3个最相关的短视频关键词，按数组格式输出：
   {{topic}}
   ```

---

**步骤 2：将关键词传入 KB 检索**

* KB 检索关键词：`{{keywords}}`

---

**步骤 3：在脚本生成节点切换高质量模型**

* 模型选择：`gpt-4-turbo` 或 `claude-3-opus`
* Prompt：

  ```
  你是一名资深短视频编导。结合以下品牌资料和热点关键词生成抖音脚本：
  品牌资料：
  {{kb_results}}
  热点关键词：
  {{keywords}}

  输出 JSON：
  {
    "title": "",
    "hook": "",
    "shots": [
      {"scene": "镜头1", "description": ""},
      {"scene": "镜头2", "description": ""}
    ],
    "hashtags": []
  }
  ```

---

**步骤 4：添加条件分支选择模型**

* 如果主题简单（字数 < 10） → 直接用小模型生成脚本
* 如果主题复杂（字数 ≥ 10） → 用大模型生成脚本
* 条件示例：

  ```
  len(topic) > 10
  ```

---

**步骤 5：测试**

1. 输入简短主题（如“夏季穿搭”） → 全流程只用小模型
2. 输入复杂主题（如“适合办公室上班族的夏季防晒穿搭技巧”） → 热词提取用小模型，正文生成用大模型

---

### 4. 成本与性能优化策略

* **缓存热点结果**：热点关键词每日更新一次即可
* **批量调用小模型**：批处理多个主题，提高并发效率
* **降级策略**：大模型调用失败时自动退回小模型
* **性能监控**：记录不同模型调用耗时与成本，定期优化

---

### 5. 实操案例

**案例目标**
构建“多平台多模型内容生成器”：

* 平台 = 抖音、小红书
* 小模型：意图识别 + 关键词提取
* 大模型：平台内容生成

**输入**：

```json
{
  "topics": ["夏季防晒穿搭", "旅行收纳技巧"],
  "platforms": ["douyin", "xiaohongshu"]
}
```

**逻辑**：

1. 循环遍历主题和平台
2. 小模型提取平台专属关键词
3. 高质量模型生成对应平台格式内容
4. 合并所有结果并导出 CSV

---

### 6. 课后作业

1. 修改你的脚本生成流程，让它支持小模型 + 大模型协作
2. 设置条件分支按主题长度选择模型
3. 测试 4 组不同长度主题，记录延迟与成本差异
4. 编写一份 50 字的优化建议


