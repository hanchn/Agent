## **第九节 · 条件分支与多路径生成**

### 1. 学习目标

* 理解条件分支（Condition）在 Flow 中的作用
* 掌握在 Coze 中配置条件判断的方法
* 能为不同输入走不同流程路径
* 支持平台、风格、人群等多维度内容生成
* 形成灵活可扩展的流程设计思路

---

### 2. 课程讲解

#### 2.1 为什么需要条件分支

* **多平台适配**：抖音、小红书、微博的内容规则不同
* **多风格创作**：搞笑、专业、故事化需要不同的 Prompt 模板
* **不同目标人群**：年轻群体与中年群体的语言风格差异大
* **不同业务场景**：推广、教学、资讯类内容生成逻辑不同

---

#### 2.2 条件分支的类型

| 类型       | 说明       | 示例                                         |
| -------- | -------- | ------------------------------------------ |
| **单条件**  | 判断一个变量的值 | `platform == 'douyin'`                     |
| **多条件**  | 多个变量组合判断 | `platform == 'douyin' && style == 'funny'` |
| **范围判断** | 数值区间     | `duration > 30`                            |
| **匹配规则** | 正则或包含关系  | `topic contains '防晒'`                      |

---

#### 2.3 Coze Flow 中的条件分支节点

* **Condition 节点**：设置布尔条件，返回 True/False 分支
* **Switch 节点**：根据变量值选择多个路径之一
* **嵌套条件**：在分支中再添加条件判断，实现多层逻辑

---

### 3. 步骤演示

#### 目标

在“短视频脚本生成流程”中，根据 **平台**（抖音 / 小红书）走不同的生成逻辑。

---

**步骤 1：修改输入节点**

* 增加一个字段：

  * 变量名：`platform`
  * 类型：枚举（`douyin`, `xiaohongshu`）
  * 占位提示：`请选择目标平台`

---

**步骤 2：添加条件分支节点**

1. 在 Flow 中，KB 节点后插入 **Condition 节点**
2. 条件设置：

   * 分支 1（True）：`platform == 'douyin'`
   * 分支 2（False）：`platform == 'xiaohongshu'`

---

**步骤 3：配置分支内的 LLM 节点**

* **抖音分支** Prompt：

  ```
  你是一名抖音短视频编导...
  输出 JSON 格式，字段包括：title, hook, shots, hashtags
  ```
* **小红书分支** Prompt：

  ```
  你是一名小红书笔记创作者...
  输出 JSON 格式，字段包括：title, content, hashtags
  ```

---

**步骤 4：合并结果**

1. 在两个分支末尾添加 **Merge 节点**
2. 输出变量统一为 `script_json`
3. 输出节点绑定 `script_json`

---

**步骤 5：测试运行**
输入：

```json
{
  "topic": "夏季防晒穿搭",
  "platform": "douyin"
}
```

→ 生成抖音脚本格式
输入：

```json
{
  "topic": "夏季防晒穿搭",
  "platform": "xiaohongshu"
}
```

→ 生成小红书笔记格式

---

### 4. 高级玩法

* **风格分支**：style = `funny` / `professional` / `story`，走不同模板
* **人群分支**：target\_audience = `youth` / `parents`，调整语言与表情符号
* **内容安全分支**：AI 检测到敏感词 → 走替换与再生成路径
* **营销分支**：如果库存<100 → 输出“限量”标签，否则走正常促销逻辑

---

### 5. 实操案例

**案例目标**
一个多平台营销文案助手，根据平台自动切换输出格式和标签规则。

**输入参数**：

* `product_name`（string）
* `platform`（枚举：douyin, xiaohongshu, weibo）
* `style`（枚举：funny, professional）

**条件逻辑**：

* **平台分支**：三条不同 Prompt 模板
* **风格分支**：在平台 Prompt 内部再切分逻辑

**输出**：

* JSON 格式，包含平台、标题、正文、标签

---

### 6. 课后作业

1. 在你的“抖音脚本生成流程”中增加平台参数（至少 2 个）
2. 为不同平台配置不同 Prompt 模板
3. 测试 4 组不同输入，记录输出差异
4. 增加一个风格变量，让平台分支下再细分输出风格
5. 提交一张你的 Flow 分支结构截图

